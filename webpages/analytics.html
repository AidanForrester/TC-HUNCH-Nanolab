<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Set the character encoding for proper text rendering -->
  <meta charset="UTF-8">

  <!-- Ensures compatibility mode is disabled in old versions of Internet Explorer -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Makes the page responsive across all devices and screen sizes -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Page title as it appears in the browser tab -->
  <title>Analytics</title>
  <!--Favicon -->
  <link rel="icon" type="X" href="../images/Tri-CountyLogo.png">
  <!-- Connects the external stylesheet that defines layout, colors, and responsiveness -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===========================
       NAVIGATION BAR
       =========================== -->
  <nav>
    <!-- ===========================
         SIDEBAR MENU (MOBILE VIEW)
         =========================== -->
    <!-- This menu is hidden by default (CSS: display:none)
         and only becomes visible when the hamburger icon is clicked. -->
    <ul class="sidebar">

      <!-- Close ("X") button — triggers hideSidebar() when clicked -->
      <li onclick="hideSidebar()">
        <a href="#">
          <!-- SVG X icon -->
          <svg xmlns="http://www.w3.org/2000/svg" height="26" width="26" viewBox="0 96 960 960">
            <path d="m249 849-42-42 231-231-231-231 42-42 
                     231 231 231-231 42 42-231 231 
                     231 231-42 42-231-231-231 231Z"/>
          </svg>
        </a>
      </li>

      <!-- Vertical list of navigation links (stacked in a column via flex-direction: column) -->
      <!-- These replicate the main navbar links but are shown in the sidebar on mobile -->
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="analytics.html">Analytics</a></li>
      <li><a href="controls.html">Controls</a></li>
      <li><a href="settings.html">Settings</a></li>
      <li><a href="about.html">About</a></li>
    </ul>

    <!-- ===========================
         MAIN NAVBAR (DESKTOP VIEW)
         =========================== -->
    <!-- This <ul> is always visible on desktop screens.
         On smaller screens (<1320px), CSS hides most links
         and shows only the hamburger button. -->
    <ul>
      <!-- Project name (aligned left via nav li:first-child { margin-right:auto; }) -->
      <li><a href="#">TC NANOLABS HUNCH</a></li> <!--Top Left Name-->

      <!-- Standard navigation links.
           These are visible on desktop but hidden on smaller screens (CSS: .hideOnMobile {display:none}) -->
      <li class="hideOnMobile"><a href="index.html">Dashboard</a></li>
      <li class="hideOnMobile"><a href="analytics.html">Analytics</a></li>
      <li class="hideOnMobile"><a href="controls.html">Controls</a></li>
      <li class="hideOnMobile"><a href="settings.html">Settings</a></li>
      <li class="hideOnMobile"><a href="about.html">About</a></li>

      <!-- ===========================
           MENU BUTTON (HAMBURGER ICON)
           =========================== -->
      <!-- Hidden by default (CSS: display:none).
           Appears when screen width <1320px via media query.
           Clicking it calls showSidebar() to display the sidebar. -->
      <li class="menu-button" onclick="showSidebar()">
        <a href="#">
          <!-- SVG Hamburger icon (three horizontal bars) -->
          <svg xmlns="http://www.w3.org/2000/svg" height="26" width="26" viewBox="0 96 960 960">
            <path d="M120 816v-60h720v60H120Z
                     M120 606v-60h720v60H120Z
                     M120 396v-60h720v60H120Z"/>
          </svg>
        </a>
      </li>
    </ul>
  </nav>

  <!-- ===========================
       JAVASCRIPT FUNCTIONALITY
       =========================== -->
  <script>
    // When user clicks the hamburger icon:
    // - Select the sidebar element.
    // - Change its display property from "none" to "flex".
    //   (CSS flex layout stacks items vertically.)
    function showSidebar() {
      const sidebar = document.querySelector('.sidebar')
      sidebar.style.display = 'flex'
    }

    // When user clicks the X icon:
    // - Hide the sidebar again by setting display to "none".
    function hideSidebar() {
      const sidebar = document.querySelector('.sidebar')
      sidebar.style.display = 'none'
    }
  </script>

  <main>
    <!DOCTYPE html>
<html lang="en">
  <meta charset="UTF-8">
  <title>Upper Moisture Sensor Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #chart-container {
      width: 80%;
      margin: auto;
    }
    #moist2 {
      font-weight: bold;
    }
  </style>
<span id="moist1" style="display:none">--</span>
<span id="moist2" style="display:none">--</span>
<body>
  <h2>Moisture Sensors Chart:</h2>
  <div id="chart-container">
    <canvas id="moistureChart"></canvas>
  </div>
  <button onclick="exportChart()">Export Moisture Chart as Image</button>

  <script>
    const ctx = document.getElementById('moistureChart').getContext('2d');
    const moistureChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Upper Moisture',
            data: [],
            borderColor: 'rgba(255, 215, 0)',
            backgroundColor: 'rgba(255, 215, 0, 0.1)',
            fill: true,
            tension: 0.4
          },
          {
            label: 'Lower Moisture',
            data: [],
            borderColor: 'blue',
            backgroundColor: 'rgba(0, 0, 255, 0.1)',
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Time' }},
          y: { title: { display: true, text: 'Moisture' }}
        }
      }
    });

    function updateChart(data) {
        moistureChart.data.datasets[0].data.push(parseFloat(data.moist1));
        moistureChart.data.datasets[1].data.push(parseFloat(data.moist2));
        const now = new Date().toLocaleTimeString();
        moistureChart.data.labels.push(now);
        moistureChart.update();
    }

    function exportChart() {
      const link = document.createElement('a');
      link.href = moistureChart.toBase64Image();
      link.download = 'moisture_chart.png';
      link.click();
    }

    async function updateData() {
        try {
            const response = await fetch('/sensor_data');
            const data = await response.json();
            document.getElementById('moist1').innerText = data.moist1;
            document.getElementById('moist2').innerText = data.moist2;

            updateChart(data);
        } catch (err) {
          console.error('Failed to fetch sensor data:', err);
        }
    }  
        setInterval(updateData, 1000);
  </script>

  <title>VOC Chart</title>
  <style>
    #chart-container1 {
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      width: 50%;
      height: 300px;
    }
    #chart-container1 canvas {
      width: 45%;                       /* each chart takes half the row */
      height: 300px;  
        }    
  </style>
  <h2>VOC Sensor Chart &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; Temperature Sensor Chart</h2>
  <div id="chart-container1">
    <canvas id="vocChart"></canvas>
    <canvas id="tempChart"></canvas>
  </div>
  <button onclick="exportChart1()">Export VOC Chart as Image</button>
  <span id="VOC" style="display:none">--</span>
  <script>
    const vocctx = document.getElementById('vocChart').getContext('2d');
    const vocChart = new Chart(vocctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Gas Resistence (kΩ)',
            data: [],
            borderColor: 'rgba(8, 14, 75)',
            backgroundColor: 'rgba(8, 14, 75, 0.1)',
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        maintainAspectRatio: false,
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Time' }},
          y: { title: { display: true, text: 'GR (kΩ)' }}
        }
      }
    });

    function updateChart1(data) {
        vocChart.data.datasets[0].data.push(parseFloat(data.VOC));
        const now = new Date().toLocaleTimeString();
        vocChart.data.labels.push(now);
        vocChart.update();
    }

    function exportChart1() {
      const link = document.createElement('a');
      link.href = vocChart.toBase64Image();
      link.download = "voc_chart.png";
      link.click();
    }

    async function updateData1() {
        try {
            const response = await fetch('/sensor_data');
            const data = await response.json();
            document.getElementById('VOC').innerText = data.VOC;

            updateChart1(data);
        } catch (err) {
          console.error('Failed to fetch sensor data:', err);
        }
    }
        setInterval(updateData1, 1000);
  </script>
  <span id="temp" style="display:none">--</span>
  <button onclick="exportChart2()">Export Temperature Chart as Image</button>
  <script>
    const tempctx = document.getElementById('tempChart').getContext('2d');
    const tempChart = new Chart(tempctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Internal Temperature(°C)',
            data: [],
            borderColor: 'red',
            backgroundColor: 'rgba(255, 0, 0, 0.1)',
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        maintainAspectRatio: false,
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Time' }},
          y: { title: { display: true, text: 'Temperature' }}
        }
      }
    });

    function updateChart2(data) {
        tempChart.data.datasets[0].data.push(parseFloat(data.temperature));
        const now = new Date().toLocaleTimeString();
        tempChart.data.labels.push(now);
        tempChart.update();
    }

    function exportChart2() {
      const link = document.createElement('a');
      link.href = tempChart.toBase64Image();
      link.download = "temp_chart.png";
      link.click();
    }

    async function updateData2() {
        try {
            const response = await fetch('/sensor_data');
            const data = await response.json();
            document.getElementById('temp').innerText = data.temperature;

            updateChart2(data);
        } catch (err) {
          console.error('Failed to fetch sensor data:', err);
        }
    }
        setInterval(updateData2, 1000);

</script>
</body>
</html>
